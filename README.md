# libspi

This library provides an interface to the SPI controller build into a range of Microchip's AVR microcontrollers. Currently, only SPI slave operation and transmission are supported. The library extends the hardware integrated controller by adding a message buffer in memory.

## Operation

SPI controllers are simple devices and there's not much to them in terms of configuration. One significant piece is its 8-bit data register. Both master and slave contain one. During a transfer, the bits residing the master's data register are shifted out into the data register of the slave, while bits in the slave's data register are shifted out into its master's data register. Effectively, they swap a single byte during a single transfer. The byte may then be retrieved from the data register and a new byte may be copied into it. The completion of a transfer may generate an interrupt. A slave follows the data clock signal generated by its master.

Libspi implements a buffer mechanism for sending data, allowing larger quantities of bytes to be sent without the need for intermediate interaction with the main program. The pointer to and size of a memory block must be provided by the user. The library then transfers its content byte by byte. It does not copy the whole memory block prior to transmission, so one must be careful when altering its contents. Functions may be registered to execute upon completion of a memory block transfer or after transferring the first byte.

A new memory block could be registered after transferring the first and the last byte by using the txstart and txdone handlers, respecitvely. An SPI slave does not generate an interrupt at the start of a byte transmission; since one or more bits may already be transferred at the time of interception, it wouldn't be of any use.

## Usage

Functions are defined in the header files located in _inc_. Each function is supplemented with a documentational block comment that describes its usage. A block comment may contain the following tags:

  * @brief
  * @param
  * @return
  * @note
  * @bug

## Build

The _tools_ folder contains an ATMEL Studio project that may be used to build the test program located in _tests_. The project is setup to link to the original files in _inc_ and _src_, thus avoiding unnecessary copies. Its build-in compiler includes _inc_ as well (_Properties > Toolchain > Directories_). Macros are defined at _Properties > Toolchain > Symbols_.

A makefile is provided, but is not setup to generate a programmable image. By using _make_, one may easily check whether the program compiles correctly and without warnings using a terminal or command-prompt.

## Devices

Device | Status
--- | ---
AT90CAN128 | Supported
